import { useEffect, useState, useMemo } from 'react'
import { useTheme } from 'next-themes'
import { Callout } from 'nextra/components'
import { Table } from 'nextra/components'

export function FAQBox({ title, children, open = false, color = '' }) {
  // Copied from /articles/provinces-municipalities.mdx
  const [isClient, setIsClient] = useState(false)
  const { theme, resolvedTheme } = useTheme()

  useEffect(() => {
    setIsClient(true)
  }, [])

  const detailsBgStyle = useMemo(() => {
    const bg = resolvedTheme === 'dark'
      ? 'bg-neutral-800'
      : 'bg-neutral-50'

    return `last-of-type:mb-0 rounded-lg ${bg} p-2 mt-4`
  }, [resolvedTheme])

  return !isClient
    ? <div>...</div>
    : (
      <details
        open={open}
        className={detailsBgStyle}
      >
        <summary>
          <strong className={`text-md ${color}`}>{title}</strong>
        </summary>
        <div className="nx-p-2">{children}</div>
      </details>
    )
}

# Firebase Storage Pricing Plan Updates (2024)

> _This article is a recap of the online meeting about changes to the Firebase Storage pricing plan held last October 14, 2024._

Firebase announced breaking changes regarding the no-cost pricing plan of their **Firebase Storage** service last September 2024. More information about this announcement is available in the [Cloud Storage Documentation for Firebase](https://firebase.google.cn/docs/storage/faqs-storage-changes-announced-sept-2024).

## FAQs

<FAQBox title="What is the Firebase Storage?">
[Firebase Storage](https://firebase.google.com/docs/storage), also known as _Firebase Cloud Storage_, is an online cloud storage service provided by Google Firebase. It is one (1) of the four (4) major Firebase components used by ACAP aside from the **Firestore Database** <sup>[[1]](https://firebase.google.com/docs/firestore/)</sup>, **Firebase Authentication** <sup>[[3]](https://firebase.google.com/docs/auth/)</sup>, and **Firebase Hosting** <sup>[[4]](https://firebase.google.com/docs/hosting/)</sup>.

ACAP uses the Firebase Storage for:

- Hosting and uploading the generated PDF bulletin recommendations, allowing public PDF downloads in its PDF Bulletins Downloads page.
- Hosting and storing several frontend picture assets and files or the Home page's GEOJSON map file (as an alternate option for using MapBox).
</FAQBox>

<FAQBox title="Are there other Firebase components used by ACAP?">
ACAP uses other Firebase components aside from the Firebase Storage. ACAP only uses the four (4) Firebase components among Firebase's [list of available](https://firebase.google.com/products-build) components/services:

- **Firestore** (Database) <sup>[[1]](https://firebase.google.com/docs/firestore/)</sup>
- **Cloud Storage** (Firebase Storage) <sup>[[2]](https://firebase.google.com/docs/storage/)</sup>
- **Authentication** (Email/Password) <sup>[[3]](https://firebase.google.com/docs/auth/)</sup>
- **Hosting** <sup>[[4]](https://firebase.google.com/docs/hosting/)</sup>
</FAQBox>

<FAQBox title="What are the notable changes (s) of this announcement?">
- Starting <u><b>October 30, 2024</b></u>, Firebase will no longer offer the no-cost Spark plan for Firebase Storage.
- More information about this announcement is available at https://firebase.google.cn/docs/storage/faqs-storage-changes-announced-sept-2024.
</FAQBox>

<FAQBox title="How will changes to Firebase Storage affect ACAP?">

Starting on <span className="font-bold text-md text-green-600">October 30, 2024</span>:

- Initializing new Firebase Storage instances <u><b>will require a payment method</b></u>. It will require new Firebase projects subscribed to the Firebase pay-as-you-go Blaze plan by default.
- Existing ACAP Firebase Storage on the no-cost Spark plan, <u><b>created before October 30, 2024</b></u>, will continue to work <u><b>until October 2025</b></u>.
- ACAP Firebase Storages not subscribed to the Firebase Blaze plan <u><b>after October 2025</b></u> will <u><b>cease to function</b></u> unless they subscribe to the Blaze plan.
- <u><b>ACAP Video Tutorials</b></u> <sup>[[1]](https://youtu.be/gJESQaT0IBQ?si=fYA19J9OHiZR4V9X&t=127)</sup> regarding the Firebase Storage initialization will not work on Firebase projects subscribed to the standard (no-cost) Firebase plans

</FAQBox>

<FAQBox title="Will the other Firebase components used by ACAP be affected?">
- No, this announcement only affects the <u>Firebase Storage</u>. Discontinued support of the Firebase standard (no-cost) pricing plan only affects the Firebase Storage.
- Other Firebase components used and activated by ACAP - the <u>Firestore Database</u>, <u>Firebase Authentication</u>, and <u>Firebase Hosting</u> still retain their standard (no-cost) pricing plans until further announcements or changes by Google Firebase.

<Callout>
Subscribing to the Firebase Blaze Plan **will automatically enroll** all Firebase components/services to the pay-as-you-go Blaze plan, not just the Firebase Storage.
However, billing charges¬†beyond the no-cost usage quotas <u>will only incur</u> on <u><b>manually activated</b></u> Firebase services.
</Callout>
</FAQBox>

<FAQBox title="Where can I find the Firebase Pricing Plan?">
The Firebase pricing plan is accessible at https://firebase.google.com/pricing.

<Callout>
Subscribing to the Firebase Blaze Plan **will automatically enroll** all Firebase components to the pay-as-you-go Blaze plan, <u>including other Firebase components not used by ACAP</u>.

ACAP only uses the following Firebase components among Firebase's [list of available](https://firebase.google.com/products-build) components/services:

- **Firestore** (Database) <sup>[[1]](https://firebase.google.com/docs/firestore/)</sup>
- **Cloud Storage** (Firebase Storage) <sup>[[2]](https://firebase.google.com/docs/storage/)</sup>
- **Authentication** (Email/Password) <sup>[[3]](https://firebase.google.com/docs/auth/)</sup>
- **Hosting** <sup>[[4]](https://firebase.google.com/docs/hosting/)</sup>

_All Firebase components service usage (including those not used by ACAP) will only reflect in the billing <u><b>upon activation</b></u> in the ACAP and <u><b>usage</b></u> beyond the no-cost Firebase plan._
</Callout>
</FAQBox>

<FAQBox title="What should I know about subscribing to the Firebase Blaze Plan?">

- Subscribing to the Firebase pay-as-you-go Blaze plan requires creating a Google Cloud billing account and electing credit card information for the Firebase project.
- ACAP only expects usage from the **Firestore Database**, **Firebase Storage**, **Authentication**, and **Hosting** Firebase services.
- Billing subscriptions will only incur beyond standard (no-cost) usage/quotas of <u><b>activated</b></u> and <u><b>used</b></u> Firebase components/services <u>enabled by developers</u>.
- If ACAP developers activate Firebase Blaze, <u><b>only the four (4) services mentioned above</b></u> are expected to incur costs unless <u><b>additional Firebase services are manually enabled</b></u>.

   <Callout>
   Refer to the Firebase Pricing table for more information about the standard (no-cost) billing and usage quotas at
   https://firebase.google.com/pricing
   </Callout>

- Firebase usage analytics are accessible at this URL with or without a subscription to the Firebase Blaze plan:

   ```text copy
   https://console.firebase.google.com/project/<YOUR_FIREBASE_PROJECT>/usage
   ```

   This page provides information for monitoring and providing insights, such as detailed pricing and usage of the active Firebase services used by the Firebase project.

   <Callout type="warning">
   ACAP expects usage only from the following Firebase services: **Firestore Database**, **Firebase Storage**, **Authentication**, and **Hosting**. [ACAP's Security guidelines](/security) only cover these four (4) Firebase components, aside from general web application security practices and know-how, e.g., stressing the need for data validation <sup>[[1]](/security/#database) [[2]](/directories/server)</sup>.

   > Developers can <u><b>use</b></u> and <u><b>activate</b></u> other Firebase components as deemed necessary when needed. However, since they are not included originally in the ACAP project Firebase components, developers should care about using them responsibly to <u>avoid incurring security issues and unexpected billing</u>.
   </Callout>
</FAQBox>

<div id="security-considerations" />
<FAQBox title="Are there security considerations that I should be aware of?" color="text-red-700 dark:nx-text-red-200">

Yes. <u>Some of the latest core deliverables</u> implemented for ACAP in its [2.0](/changelog/#version-2-acap-20) version [**introduced security flaws**](/changelog#acap-2-security-debts) not present in the initial ([1.0](/changelog/#version-1-acap-10)) version, which had strictly followed [security guidelines](/security) and adhered to best practices in web development security, effectively preventing these issues. Based on the following criteria, the new security flaws introduced in version 2.0 resulted in a **60% reduction in the established security from version 1.0**.

<Callout>
> With ACAP 2.0+, a <u><b>new code maintainer and lead programmer</b></u> took over core development. You can check the [ACAP repository](https://github.com/amia-cis/acap-v2/issues/57) for more details.
>
> To speed up development, they introduced a more flexible Firestore database setup. However, this also loosened security rules, raising concerns not present in version 1.0. The¬†<u><b>same lead programmer</b></u>¬†is aware of the trade-offs, and¬†<u>since they made these changes, they‚Äôre the best person to contact for security updates and fixes.</u>
</Callout>

| Criteria | Purpose | ACAP [1.0](/changelog/#version-1-acap-10) | ACAP [2.0](/changelog/#version-2-acap-20) |
| --- | --- | :---: | :---: |
| User authentication | Authorized, allowed, and predictable operations access to resources | ‚úÖ | ‚úÖ |
| Cross-Site Scripting (XSS) Protection | <u>Predictable billing</u>, reliable/authentic website information, <u>user information confidentiality</u>, predictable data manipulation / SMS sending, protection for <u>unvalidated writes that allow tampering with stored data</u>, impacting system reliability, protection for <u>injecting malicious scripts</u> that <u>steal user info</u> or <u>redirect users to phishing sites</u> (and protection for other uncontrolled scenarios that stem from XSS) | ‚úÖ | ‚ùå |
| Cloud storage protection | Authorized, allowed, and predictable operations access to storage, <u>predictable billing</u> | ‚úÖ | ‚úÖ |
| Database integrity | Accuracy, consistency, and <u>reliability</u> of data stored in a database and presented to users | ‚úÖ | ‚ùå |
| Database protection | Authorized, allowed, and predictable operations access to the (Firestore) database, <u>predictable billing</u> | ‚úÖ | ‚ùå |

Ensuring **system integrity** and **strong security measures** is critical when handling:

1. Sensitive user information (e.g., full name and contact numbers)
2. Paid subscription to external services (e.g., Firebase, Semaphore)
3. Reliable and predictable information output and system performance

##### Why Security Matters Before Upgrading Firebase

Activating a paid Firebase subscription unlocks advanced features, but security considerations must be addressed first. Unresolved security flaws introduced in the latest core deliverables for [ACAP 2.0+](/changelog/#version-2-acap-20) could lead to <u>data breaches</u>, <u>unauthorized changes</u>, and <u>increased costs</u>.

<Callout type="error" emoji="">
üö´

Before activating a paid Firebase subscription, consider whether unresolved [ACAP Security Technical Debts](/changelog#acap-2-security-debts) exist. **[ACAP 2.0+](/changelog/#version-2-acap-20) introduces known security flaws** that may impact user confidentiality, system integrity, and reliability.

#### Key issues include:

1. **Lenient Firestore security rules** ‚Äì Direct **writes via Firestore REST APIs** bypass front-end controls, potentially allowing unauthorized data entry.
   ```text copy
   Temporary Mitigation: Restrict writes using Firestore security rules.
   Permanent Mitigation: Permanently restrict writes using
      Firestore security rules and perform database WRITE operations
      from the Node backend coupled with data validation.
   ```
2. **Cross-Site Scripting (XSS) vulnerability** ‚Äì **WYSIWYG crop recommendations** (only when "editing" recommendations) allow unvalidated HTML input, which may lead to stored XSS attacks (malicious scripts that persist in the database and execute when viewed).
   ```text copy
   Temporary Mitigation: Implement input sanitization before storage.
   Permanent Mitigation: Permanently restrict writes using
      Firestore security rules and perform database WRITE operations
      from the Node backend coupled with more
      robust/predictable data sanitization.
   ```
3. **Firestore database pollution** ‚Äì Insufficient validation in **"Support Services"** data allows disorganized writes, which could:
   - Lead to excessive Firebase usage.
   - Create unexpected document structures, affecting query performance.
   ```
   Temporary Mitigation: Validate schema before database writes.
   ```

For more details, see [ACAP Security Technical Debts](/changelog/#acap-2-security-debts).
If these issues with specific information (available at the (private) parent **acap-v2** GitHub Repository Issues list [[1]](https://github.com/amia-cis/acap-v2/issues/57) and [[2]](https://github.com/amia-cis/acap-v2/issues/34)) remain unaddressed, it may be beneficial to consult the <u><b>new ACAP Maintainer</b></u> who is also the <u><b>lead ACAP programmer</b></u> responsible for designing and implementing [ACAP 2.0](/changelog/#version-2-acap-20) before activating a paid Firebase subscription.

Key topics to discuss include:

- How security concerns introduced in ACAP 2.0+ are being addressed
- Plans for improving security and risk mitigation before enabling Firebase

#### Next Steps for Developers

- **Review the Firestore security rules** to restrict direct database writes.
- **Check for XSS vulnerabilities** in crop recommendations and apply sanitization.
- **Monitor database writes** for unstructured or excessive storage.
- **Consult the <u>new ACAP Maintainer</u> who is also the <u>lead ACAP programmer</u> responsible for implementing the core [version 2.0+](/changelog/#version-2-acap-20)** deliverables for current mitigation strategies and planned fixes.
</Callout>

<Callout type="info">
ACAP's [Security measures and practices for Firebase](/security) only cover the Firebase components that it actively uses: **Firestore Database**, **Firebase Storage**, **Authentication**, and **Hosting**.

Developers are encouraged to learn more about responsible Security measures and practices for other Firebase components or services, should they feel the need to <u>use</u> and <u>activate</u> [other Firebase services](https://firebase.google.com/products-build) (e.g., **Firebase ML**, **Cloud Functions**, **Extensions**, etc) for their ACAPs other than **four (4) main Firebase components** used by ACAP.
</Callout>
</FAQBox>

## Firebase Storage Alternate Options

The meeting discussed the following alternate options for ACAP's Firebase Storage component, considering the discontinuation of its no-cost pricing plan.

1. Subscribe to the Firebase Blaze Plan
2. Integrate a new standard plan (free-tier) Cloud Storage Provider to replace Firebase Storage
3. Use the (Render) server file system for hosting PDFs
