import { Callout, Steps } from 'nextra/components'

# Deployment

Refer to the [Video Tutorials](/video) section items for more information about deployment and other development-related video tutorials.

<Callout type="info" emoji="ℹ️">
These videos created for ACAP's initial release (ACAP 1.0) back in **2023** should still be compatible with the latest ACAP 2.0, with minor changes and updates.

Follow the steps in the **Render Initial Blueprint Instance** section to sync its Render deployment methods with the ACAP 2.0 updates.
</Callout>

## Git Flow

CI/CD using GitHub Actions deploy code updates to the **development** or **production** environments following this [simplified version of Git Flow](https://youtu.be/cV-9KszXEyw?feature=shared&t=845).

<img src="https://firebasestorage.googleapis.com/v0/b/assets-cms.appspot.com/o/users%2FAwryJ0MU8zdxQFh9y0L0x2sSt8z1%2Ffd8YN8jIdC6dikTDYllr_file?alt=media&token=050ea71e-d56c-4844-ad8e-7c796b123b5d" alt="acap-git-flow" style={{ margin: "auto" }} />


**(Optional)** Before proceeding, create a GitHub Issue describing the new feature, bug fix or task that you'll develop. This tracks the details of the incoming updates.

<Steps>

### Create a feature branch

- Create a **feature branch** branching out from the **dev branch**

   > If a GitHub Issue describes this feature, name the branch with the GitHub Issue number eg., `feat/acaptutorials-12` (Issue #12)

   ```sh
   git checkout dev
   git checkout -b feat/acaptutorials-12

   # Using other branch names
   # git checkout -b awesome-update
   ```

- This isolates new work (feature, bug fix, or task) so it doesn't destabilize the shared development branch.

### Merge the feature branch back to dev

- Once the feature is complete and reviewed via a **Pull Request (PR)**, it's merged back into **dev**.
- Approving a PR to the dev branch (or pushing updates directly to the dev branch) triggers a deployment to the **development** (Firebase Hosting, Render and, [Vercel](/articles/deployment-vercel) (if available)) environment.
- It allows testing the feature with other in-progress features in an integrated (development) environment.
- Delete the feature branch afterward to keep the repository clean.

### Promote dev to master

- When the **dev branch** has accumulated stable, tested features, create a Pull Request (PR) to **master**
- The master branch always reflects the code that's safe to release to production.

### Tag a release

- Tag and version a release from the **master branch** (e.g., v1.0.0).
- This creates an immutable snapshot of the code that corresponds to a specific release.
- It also triggers a deployment to the **production** (GitHub Pages, Render and, [Vercel](/articles/deployment-vercel) (if available)) environment.

</Steps>

## Render Initial Blueprint Instance

These steps complement the video tutorials for creating a Blueprint Instance, making them compatible with latest ACAP version (ACAP 2.0).

<Callout type="default" emoji="💡">
**acap-v2** has updated source codes at Release tag <b>{process.env.RELEASE_VERSION}</b> dev branch @commit <b>{process.env.COMMIT_ID}</b>.
</Callout>

<Steps>

### Create a Blueprint Instance

Follow the video guides for creating a Blueprint Instance for the `development` or `production` environment.

- **10 Deployment to Development Environment**
- **11 Deployment to Production Environment**

### Create Render Secrets

ACAP 2.0 now requires Docker secrets (secret files) in its build stage to build its API documentation, using default values if "secret" files are undefined during the build stage.

<Callout type="info" emoji="ℹ️">
Render does not support adding Secrets (Docker secret files) on initial Blueprint creation. Create these Render **Secrets** with appropriate values after launching a Render **Web Service** connected to the **Blueprint Instance** to provide correct values during the succeeding Render build stages.
</Callout>

1. Go to **Dashboard** → newly-created **Web Service** (associated with the Blueprint) → **Environment**.
2. Go to the **Secret Files** section under the **Environment** page.
3. Add the following **"Render Secrets"**. Refer to the `acap-v2/README` file's **Render Secrets** section to know more about these variables and their values.

   ```env copy
   LIVE_ORIGIN
   REGION_NAME
   ROOT_API_URL
   IS_RMCAS_API_ACTIVE
   ```

### Update Render Variables

Set the Render Environment variables if the [ACAP-RCMAS APIs](/post-installation/acap-rcmas-api) are active.

Refer to the `acap-v2/server/README` and root `acap-v2/README` files' **environment variables** sections to know more about these variables and their values.

```env copy
IS_RMCAS_API_ACTIVE=0
ARCHIVE_TENDAY_FORECAST=0
```

### Re-deploy

Re-deploy the server (from GitHub Actions) or manually from the Render dashboard to build the correct values for the online API documentation using the Render Secret values.

</Steps>
